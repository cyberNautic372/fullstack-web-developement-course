<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberpunk Weather Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --cyber-blue: #0ff;
            --cyber-pink: #f0f;
            --cyber-green: #0f0;
            --cyber-purple: #a0f;
            --cyber-orange: #ff5500;
            --grid-color: rgba(0, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: #000811;
            color: var(--cyber-blue);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        /* Dynamic Background Effects */
        .background-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        /* Grid Background */
        .grid-bg {
            position: absolute;
            inset: 0;
            background: 
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px) 0 0 / 50px 50px,
                linear-gradient(0deg, var(--grid-color) 1px, transparent 1px) 0 0 / 50px 50px,
                radial-gradient(circle at 50% 50%, rgba(0, 40, 80, 0.3), #000811);
        }
        
        /* Weather Animations */
        .sun-glow {
            position: absolute;
            top: 10%;
            left: 15%;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #ffaa00, #ff5500, transparent 70%);
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0;
            animation: sunPulse 8s infinite ease-in-out;
        }
        
        .sun-rays {
            position: absolute;
            top: 10%;
            left: 15%;
            width: 120px;
            height: 120px;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 170, 0, 0.2) 15deg, transparent 30deg, rgba(255, 85, 0, 0.2) 45deg, transparent 60deg);
            border-radius: 50%;
            opacity: 0;
            animation: rotateRays 20s linear infinite;
        }
        
        .cloud {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(200, 230, 255, 0.1));
            border-radius: 50px;
            filter: blur(25px);
        }
        
        .rain-drop {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom, rgba(0, 200, 255, 0.8), rgba(0, 100, 255, 0.3));
        }
        
        /* Weather Theme Backgrounds */
        .sunny-bg {
            background: 
                radial-gradient(circle at 20% 10%, #ff880033, transparent 50%),
                radial-gradient(circle at 80% 90%, #0088ff33, transparent 50%),
                linear-gradient(to bottom, #000c1a, #001a33);
            animation: skyShift 60s infinite linear;
        }
        
        .cloudy-bg {
            background: linear-gradient(to bottom, #001122, #003344);
            animation: cloudySky 120s infinite linear;
        }
        
        .rainy-bg {
            background: linear-gradient(to bottom, #001133, #002244);
            animation: rainSky 30s infinite linear;
        }
        
        .stormy-bg {
            background: linear-gradient(to bottom, #000811, #001122);
            animation: stormSky 30s infinite alternate;
        }
        
        .foggy-bg {
            background: linear-gradient(to bottom, #001111, #002222);
            animation: fogShift 40s infinite linear;
        }
        
        .snowy-bg {
            background: linear-gradient(to bottom, #000c22, #001133);
            animation: snowShift 60s infinite linear;
        }
        
        /* Animations */
        @keyframes sunPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        
        @keyframes rotateRays {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes cloudFloat {
            from { transform: translateX(-200px) translateY(0); opacity: 0.3; }
            to { transform: translateX(calc(100vw + 400px)) translateY(20px); opacity: 0.8; }
        }
        
        @keyframes rainFall {
            to { transform: translateY(calc(100vh + 50px)); }
        }
        
        @keyframes snowFall {
            to { transform: translateY(calc(100vh + 50px)) rotate(360deg); }
        }
        
        @keyframes skyShift {
            0%, 100% { background-position: 0 0, 0 0; }
            50% { background-position: 100px 50px, -100px -50px; }
        }
        
        @keyframes cloudySky {
            0% { background-position: 0 0; }
            100% { background-position: 1000px 1000px; }
        }
        
        @keyframes rainSky {
            0%, 100% { filter: brightness(0.9); }
            50% { filter: brightness(1); }
        }
        
        @keyframes stormSky {
            0%, 100% { filter: brightness(0.8); }
            50% { filter: brightness(1.2); }
        }
        
        @keyframes fogShift {
            0%, 100% { filter: brightness(0.9) blur(1px); }
            50% { filter: brightness(1.1) blur(2px); }
        }
        
        @keyframes snowShift {
            0%, 100% { background-position: 0 0; }
            50% { background-position: 50px 50px; }
        }
        
        /* UI Components */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .header-glow {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header-glow h1 {
            font-size: 2em;
            font-weight: 900;
            text-shadow: 
                0 0 10px var(--cyber-blue),
                0 0 20px var(--cyber-blue),
                0 0 40px var(--cyber-blue),
                0 0 80px var(--cyber-blue);
            animation: textGlow 2s infinite alternate;
            margin-bottom: 10px;
        }
        
        @keyframes textGlow {
            from { text-shadow: 0 0 10px var(--cyber-blue), 0 0 20px var(--cyber-blue); }
            to { text-shadow: 0 0 20px var(--cyber-blue), 0 0 40px var(--cyber-blue), 0 0 60px var(--cyber-blue); }
        }
        
        .top {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: rgba(0, 20, 40, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--cyber-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
        }
        
        .search-container {
            flex: 1;
            position: relative;
            min-width: 300px;
        }
        
        #city {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--cyber-blue);
            color: var(--cyber-blue);
            border-radius: 6px;
            font-family: 'Orbitron', monospace;
            font-size: 14px;
        }
        
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 10, 20, 0.95);
            border: 2px solid var(--cyber-blue);
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            color: #0ff;
        }
        
        .suggestion-item:hover {
            background: rgba(0, 255, 255, 0.1);
        }
        
        button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #000, #002);
            border: 2px solid;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 140px;
        }
        
        #scan {
            border-color: var(--cyber-pink);
            color: var(--cyber-pink);
            text-shadow: 0 0 10px var(--cyber-pink);
        }
        
        #scan:hover {
            box-shadow: 0 0 20px var(--cyber-pink);
            background: linear-gradient(135deg, #200020, #400040);
        }
        
        .gpsBtn {
            border-color: var(--cyber-green);
            color: var(--cyber-green);
            text-shadow: 0 0 10px var(--cyber-green);
        }
        
        .gpsBtn:hover {
            box-shadow: 0 0 20px var(--cyber-green);
            background: linear-gradient(135deg, #002000, #004000);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .card {
            background: linear-gradient(145deg, rgba(0, 20, 40, 0.9), rgba(0, 10, 20, 0.9));
            border: 2px solid var(--cyber-blue);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 
                0 0 15px rgba(0, 255, 255, 0.3),
                inset 0 0 15px rgba(0, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--cyber-blue), transparent);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 0 25px rgba(0, 255, 255, 0.5),
                0 5px 15px rgba(0, 0, 0, 0.5),
                inset 0 0 20px rgba(0, 255, 255, 0.2);
        }
        
        .chart-container {
            width: 100%;
            background: linear-gradient(145deg, rgba(0, 20, 40, 0.9), rgba(0, 10, 20, 0.9));
            border: 2px solid var(--cyber-purple);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(160, 0, 255, 0.3);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        #hourChart {
            width: 100%;
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
        }
        
        /* Fixed AQI Ring */
        .aqi-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .aqi-ring {
            position: relative;
            width: 150px;
            height: 150px;
        }
        
        .aqi-circle-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#111 0deg, #111 360deg);
        }
        
        .aqi-circle-fill {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--aqi-color, #0f0) 0deg, #111 0deg);
            transition: background 1s ease;
            clip-path: polygon(50% 0, 50% 0, 50% 50%, 50% 50%);
            animation: aqiFill 2s ease-out forwards;
        }
        
        .aqi-mask {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(0, 10, 20, 0.95);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .aqi-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            font-weight: 900;
            color: var(--aqi-color, #0f0);
            text-shadow: 0 0 15px currentColor;
            z-index: 2;
        }
        
        .aqi-label {
            font-size: 12px;
            color: var(--aqi-color, #0f0);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }
        
        @keyframes aqiFill {
            to {
                clip-path: polygon(50% 0, 50% 0, calc(50% + var(--aqi-percent, 50%) * 50%) 50%, 50% 50%);
            }
        }
        
        /* Additional Weather Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .metric-item {
            background: rgba(0, 30, 60, 0.5);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--cyber-purple);
        }
        
        .metric-label {
            font-size: 11px;
            color: #aaa;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* Enhanced Moon Phase */
        .moon-phase {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .moon-visual {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #333, #111);
            position: relative;
            overflow: hidden;
            box-shadow: 
                inset 0 0 15px rgba(255, 255, 255, 0.1),
                0 0 20px rgba(255, 255, 255, 0.2);
        }
        
        .moon-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(135deg, #ddd, #aaa);
            border-radius: 50%;
            transition: width 1s ease;
        }
        
        .altitude-display {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 10px;
            padding: 12px;
            background: rgba(0, 20, 40, 0.5);
            border-radius: 8px;
            border-left: 3px solid var(--cyber-orange);
        }
        
        /* Enhanced Forecast */
        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .forecast-card {
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid var(--cyber-blue);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .forecast-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--cyber-blue), transparent);
        }
        
        .forecast-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }
        
        /* Progress Bars */
        .progress-bar {
            height: 8px;
            background: #002;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: #0ff;
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 2s infinite;
        }
        
        @keyframes shine {
            to { left: 100%; }
        }
        
        /* Status Indicators */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--cyber-blue);
        }
        
        .loading-spinner {
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--cyber-blue);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .error-message {
            display: none;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #f00;
            border-radius: 6px;
            color: #f00;
            animation: errorPulse 2s infinite;
        }
        
        @keyframes errorPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #0f0;
            border-radius: 6px;
            color: #0f0;
        }
        
        .gps-status {
            font-size: 12px;
            color: #0f0;
            margin-top: 5px;
            text-align: center;
        }
        
        .last-updated {
            font-size: 11px;
            color: #888;
            text-align: center;
            margin-top: 5px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header-glow h1 { font-size: 1.5em; }
            .top { flex-direction: column; }
            .search-container, button { width: 100%; }
            .grid { grid-template-columns: 1fr; }
            .forecast-grid { grid-template-columns: repeat(4, 1fr); }
            .card { min-height: 180px; padding: 15px; }
            .chart-header { flex-direction: column; align-items: flex-start; }
            #hourChart { height: 220px; }
            .aqi-ring { width: 120px; height: 120px; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .forecast-grid { grid-template-columns: repeat(2, 1fr); }
            .aqi-ring { width: 100px; height: 100px; }
            .aqi-value { font-size: 24px; }
            .moon-visual { width: 60px; height: 60px; }
            .metric-item { padding: 8px; }
            .metric-value { font-size: 16px; }
        }
    </style>
</head>
<body>
    <!-- Background Effects Container -->
    <div class="background-effects">
        <div class="grid-bg"></div>
        <div class="sun-glow"></div>
        <div class="sun-rays"></div>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        <div class="header-glow">
            <h1>CYBER WEATHER SCAN</h1>
            <div class="top">
                <div class="search-container">
                    <input type="text" id="city" placeholder="TYPE CITY NAME (e.g., Shimla, Delhi, Mumbai)..." autocomplete="off">
                    <div id="suggestions"></div>
                </div>
                <button id="scan">SCAN WEATHER</button>
                <button id="gps" class="gpsBtn">GPS LOCK</button>
            </div>
            <div class="gps-status" id="gpsStatus">GPS: READY</div>
            <div class="last-updated" id="lastUpdated"></div>
        </div>
        
        <div id="currentCity" style="text-align:center; margin:10px 0; font-size:1.2em; color:var(--cyber-blue);">
            TYPE CITY NAME TO SEARCH
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>SCANNING...</div>
        </div>
        
        <div class="grid">
            <div class="card" id="currentWeather">
                <h3 style="color:var(--cyber-blue); margin:0 0 10px 0;">CURRENT SCAN</h3>
                <div id="weatherIcon" style="font-size:50px; margin:10px 0;">üìç</div>
                <div id="tempDisplay" style="font-size:22px; font-weight:bold; margin:5px 0;">--¬∞C</div>
                <div id="feelsLike" style="font-size:14px; color:#aaa;">Feels like --¬∞C</div>
                <div id="weatherDesc" style="font-size:12px; color:#0ff; margin-top:5px;">--</div>
                <div class="altitude-display">
                    <div class="altitude-icon">‚õ∞Ô∏è</div>
                    <div>
                        <div class="altitude-value" id="altitudeValue">--</div>
                        <div class="altitude-unit">meters above sea level</div>
                    </div>
                </div>
            </div>
            
            <div class="card" id="sunMoonInfo">
                <h3 style="color:var(--cyber-pink); margin:0 0 10px 0;">CELESTIAL DATA</h3>
                <div style="margin:10px 0;">
                    <div style="color:#0ff; font-size:14px;">SUNRISE: <span id="sunriseTime">--:--</span></div>
                    <div style="color:#0ff; font-size:14px; margin-top:8px;">SUNSET: <span id="sunsetTime">--:--</span></div>
                    <div style="color:#0ff; font-size:14px; margin-top:8px;">DAYLENGTH: <span id="dayLength">-- hrs</span></div>
                </div>
                <div class="moon-phase">
                    <div class="moon-visual"><div class="moon-fill" id="moonFill"></div></div>
                    <div>
                        <div class="moon-phase-text">MOON PHASE</div>
                        <div style="color:#fff; font-size:16px; margin-top:3px;" id="moonPhase">--</div>
                        <div style="color:#888; font-size:11px; margin-top:2px;" id="moonIllumination">--% illuminated</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="color:var(--cyber-green); margin:0 0 10px 0;">AIR QUALITY INDEX</h3>
                <div class="aqi-container">
                    <div class="aqi-ring">
                        <div class="aqi-circle-bg"></div>
                        <div class="aqi-circle-fill" id="aqiCircleFill"></div>
                        <div class="aqi-mask"></div>
                        <div class="aqi-value" id="aqiValue">--</div>
                    </div>
                    <div class="aqi-label" id="aqiLabel">ENTER CITY</div>
                </div>
            </div>
        </div>
        
        <h3 style="color:var(--cyber-blue); margin:25px 0 15px 0;">WEATHER METRICS</h3>
        
        <div class="grid">
            <div class="card">
                <div style="color:#aaa; font-size:14px;">HUMIDITY</div>
                <div id="humidityValue" style="font-size:28px; margin:10px 0;">--%</div>
                <div class="progress-bar"><div class="progress-fill" id="humidityFill"></div></div>
            </div>
            
            <div class="card">
                <div style="color:#aaa; font-size:14px;">UV INDEX</div>
                <div id="uvValue" style="font-size:28px; margin:10px 0;">--</div>
                <div id="uvRisk" style="color:#ff0; font-size:12px; margin-top:5px;">--</div>
                <div class="progress-bar"><div class="progress-fill" id="uvFill" style="background:#ff0;"></div></div>
            </div>
            
            <div class="card">
                <div style="color:#aaa; font-size:14px;">PRECIPITATION</div>
                <div id="precipValue" style="font-size:28px; margin:10px 0;">--%</div>
                <div style="color:#a0f; font-size:12px; margin-top:5px;">Chance of rain</div>
                <div class="progress-bar"><div class="progress-fill" id="precipFill" style="background:#a0f;"></div></div>
            </div>
            
            <div class="card">
                <div style="color:#aaa; font-size:14px;">WIND SPEED</div>
                <div id="windValue" style="font-size:28px; margin:10px 0;">-- km/h</div>
                <div id="windGustValue" style="color:#0f0; font-size:12px; margin-top:5px;">Gust: -- km/h</div>
                <div id="windDirection" style="color:#888; font-size:11px; margin-top:5px;">Direction: --</div>
            </div>
        </div>
        
        <!-- Additional Metrics -->
        <div class="metrics-grid" id="additionalMetrics">
            <div class="metric-item">
                <div class="metric-label">PRESSURE</div>
                <div class="metric-value" id="pressureValue">-- hPa</div>
            </div>
            <div class="metric-item">
                <div class="metric-label">VISIBILITY</div>
                <div class="metric-value" id="visibilityValue">-- km</div>
            </div>
            <div class="metric-item">
                <div class="metric-label">CLOUD COVER</div>
                <div class="metric-value" id="cloudCoverValue">--%</div>
            </div>
            <div class="metric-item">
                <div class="metric-label">DEW POINT</div>
                <div class="metric-value" id="dewPointValue">--¬∞C</div>
            </div>
        </div>
        
        <h3 style="color:var(--cyber-pink); margin:25px 0 15px 0;">7-DAY FORECAST</h3>
        
        <div class="forecast-grid" id="forecastContainer">
            <!-- Forecast cards will be added here -->
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <h3 style="color:var(--cyber-purple); margin:0;">HOURLY TEMPERATURE TREND</h3>
                <div style="color:#aaa; font-size:12px;">NEXT 24 HOURS</div>
            </div>
            <canvas id="hourChart"></canvas>
            <div style="display:flex; justify-content:space-between; margin-top:8px; color:#aaa; font-size:11px;">
                <div>‚Üê TIME (HOURS) ‚Üí</div>
                <div>‚Üë TEMPERATURE (¬∞C) ‚Üì</div>
            </div>
        </div>
    </div>

    <script>
        class WeatherDashboard {
            constructor() {
                this.weatherIcons = {
                    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è",
                    61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 66: "üå®Ô∏è", 67: "üå®Ô∏è",
                    71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", 77: "üå®Ô∏è", 80: "üå¶Ô∏è",
                    81: "üå¶Ô∏è", 82: "üå¶Ô∏è", 85: "üå®Ô∏è", 86: "üå®Ô∏è", 95: "‚õàÔ∏è",
                    96: "‚õàÔ∏è", 99: "‚õàÔ∏è"
                };
                
                this.weatherDescriptions = {
                    0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
                    45: "Fog", 48: "Depositing rime fog",
                    61: "Slight rain", 63: "Moderate rain", 65: "Heavy rain",
                    66: "Light freezing rain", 67: "Heavy freezing rain",
                    71: "Slight snow", 73: "Moderate snow", 75: "Heavy snow",
                    77: "Snow grains", 80: "Slight rain showers", 81: "Moderate rain showers",
                    82: "Violent rain showers", 85: "Slight snow showers", 86: "Heavy snow showers",
                    95: "Thunderstorm", 96: "Thunderstorm with slight hail", 99: "Thunderstorm with heavy hail"
                };
                
                this.debounceTimer = null;
                this.currentEffects = [];
                this.setupEventListeners();
                this.initializeEmptyState();
                this.checkGPS();
            }
            
            setupEventListeners() {
                const cityInput = document.getElementById('city');
                const scanButton = document.getElementById('scan');
                const gpsButton = document.getElementById('gps');
                
                // Real-time suggestions
                cityInput.addEventListener('input', (e) => {
                    this.handleCityInput(e.target.value);
                });
                
                // Suggestions dropdown
                document.getElementById('suggestions').addEventListener('click', (e) => {
                    if (e.target.classList.contains('suggestion-item')) {
                        const cityData = JSON.parse(e.target.dataset.city);
                        document.getElementById('city').value = cityData.name;
                        this.hideSuggestions();
                        this.loadWeatherFromSuggestion(cityData);
                    }
                });
                
                // Search button
                scanButton.addEventListener('click', () => {
                    const city = cityInput.value.trim();
                    if (city) {
                        this.searchAndLoadWeather(city);
                    }
                });
                
                // Enter key to search
                cityInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const city = cityInput.value.trim();
                        if (city) {
                            this.searchAndLoadWeather(city);
                        }
                    }
                });
                
                // GPS button
                gpsButton.addEventListener('click', () => this.handleGPS());
                
                // Close suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.search-container')) {
                        this.hideSuggestions();
                    }
                });
                
                // Auto-refresh every 10 minutes
                setInterval(() => {
                    if (document.getElementById('city').value.trim()) {
                        this.searchAndLoadWeather(document.getElementById('city').value.trim());
                    }
                }, 600000);
            }
            
            checkGPS() {
                if (navigator.geolocation) {
                    document.getElementById('gpsStatus').textContent = 'GPS: READY';
                    document.getElementById('gpsStatus').style.color = '#0f0';
                } else {
                    document.getElementById('gpsStatus').textContent = 'GPS: NOT SUPPORTED';
                    document.getElementById('gpsStatus').style.color = '#f00';
                    document.getElementById('gps').disabled = true;
                }
            }
            
            async handleCityInput(query) {
                if (query.length < 2) {
                    this.hideSuggestions();
                    return;
                }
                
                clearTimeout(this.debounceTimer);
                
                this.debounceTimer = setTimeout(async () => {
                    try {
                        const suggestions = await this.fetchCitySuggestions(query);
                        this.showSuggestions(suggestions);
                    } catch (error) {
                        console.log('Failed to fetch suggestions:', error);
                    }
                }, 300);
            }
            
            async fetchCitySuggestions(query) {
                try {
                    const response = await fetch(
                        `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=10&language=en&format=json`
                    );
                    
                    if (!response.ok) throw new Error('Geocoding API failed');
                    
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        return data.results.map(city => ({
                            name: city.name,
                            country: city.country,
                            admin1: city.admin1,
                            latitude: city.latitude,
                            longitude: city.longitude,
                            elevation: city.elevation
                        }));
                    }
                    
                    return [];
                    
                } catch (error) {
                    console.error('Geocoding error:', error);
                    return [];
                }
            }
            
            showSuggestions(suggestions) {
                const container = document.getElementById('suggestions');
                
                if (suggestions.length === 0) {
                    container.style.display = 'none';
                    return;
                }
                
                container.innerHTML = '';
                
                suggestions.forEach(city => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.textContent = `${city.name}, ${city.admin1 || city.country}`;
                    div.dataset.city = JSON.stringify(city);
                    container.appendChild(div);
                });
                
                container.style.display = 'block';
            }
            
            hideSuggestions() {
                document.getElementById('suggestions').style.display = 'none';
            }
            
            async searchAndLoadWeather(cityName) {
                this.showLoading(true);
                this.showMessage(`Searching for ${cityName}...`, 'loading');
                this.hideMessages();
                
                try {
                    const location = await this.getCityCoordinates(cityName);
                    
                    if (!location) throw new Error('City not found');
                    
                    await this.loadWeatherData(location.latitude, location.longitude, location.name, location.elevation);
                    
                } catch (error) {
                    this.showLoading(false);
                    this.showError(`Failed to find ${cityName}. Please try another city.`);
                }
            }
            
            async loadWeatherFromSuggestion(cityData) {
                this.showLoading(true);
                this.showMessage(`Loading ${cityData.name}...`, 'loading');
                this.hideMessages();
                
                try {
                    await this.loadWeatherData(
                        cityData.latitude, 
                        cityData.longitude, 
                        cityData.name, 
                        cityData.elevation
                    );
                } catch (error) {
                    this.showLoading(false);
                    this.showError('Failed to load weather data');
                }
            }
            
            async handleGPS() {
                if (!navigator.geolocation) {
                    this.showError('Geolocation is not supported by your browser');
                    return;
                }
                
                this.showLoading(true);
                this.showMessage('Getting your location...', 'loading');
                this.hideMessages();
                
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        });
                    });
                    
                    // Get city name from coordinates
                    const cityName = await this.getCityNameFromCoords(
                        position.coords.latitude, 
                        position.coords.longitude
                    );
                    
                    document.getElementById('city').value = cityName;
                    
                    // Load weather for current location
                    await this.loadWeatherData(
                        position.coords.latitude,
                        position.coords.longitude,
                        cityName,
                        position.coords.altitude || 0
                    );
                    
                    // Update GPS status
                    document.getElementById('gpsStatus').textContent = `GPS: ACTIVE (${Math.round(position.coords.accuracy)}m accuracy)`;
                    document.getElementById('gpsStatus').style.color = '#0f0';
                    
                } catch (error) {
                    this.showLoading(false);
                    
                    if (error.code === 1) {
                        this.showError('Location access denied. Please allow location access in browser settings.');
                    } else if (error.code === 2) {
                        this.showError('Location unavailable. Please check your GPS/network connection.');
                    } else if (error.code === 3) {
                        this.showError('Location request timed out. Please try again.');
                    } else {
                        this.showError(`GPS Error: ${error.message}`);
                    }
                    
                    document.getElementById('gpsStatus').textContent = 'GPS: FAILED';
                    document.getElementById('gpsStatus').style.color = '#f00';
                }
            }
            
            async getCityCoordinates(cityName) {
                try {
                    const response = await fetch(
                        `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityName)}&count=1&language=en`
                    );
                    
                    if (!response.ok) throw new Error('Geocoding failed');
                    
                    const data = await response.json();
                    
                    if (data.results && data.results[0]) {
                        return {
                            name: data.results[0].name,
                            latitude: data.results[0].latitude,
                            longitude: data.results[0].longitude,
                            elevation: data.results[0].elevation,
                            country: data.results[0].country,
                            admin1: data.results[0].admin1
                        };
                    }
                    
                    return null;
                    
                } catch (error) {
                    console.error('Geocoding error:', error);
                    return null;
                }
            }
            
            async getCityNameFromCoords(lat, lon) {
                try {
                    const response = await fetch(
                        `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en`
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.results && data.results[0]) {
                            return data.results[0].name || 'Your Location';
                        }
                    }
                    
                    return 'Your Location';
                    
                } catch (error) {
                    console.error('Reverse geocoding error:', error);
                    return 'Your Location';
                }
            }
            
            async loadWeatherData(lat, lon, cityName, elevation) {
                try {
                    // Enhanced API call with more parameters
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,showers,snowfall,weather_code,pressure_msl,surface_pressure,cloud_cover,wind_speed_10m,wind_direction_10m,wind_gusts_10m,visibility&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,weather_code,wind_speed_10m,visibility&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum,rain_sum,showers_sum,snowfall_sum,precipitation_hours,precipitation_probability_max,wind_speed_10m_max,wind_gusts_10m_max&timezone=auto&forecast_days=7`;
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) throw new Error('Weather API failed');
                    
                    const weatherData = await response.json();
                    
                    if (!weatherData.current) throw new Error('Invalid weather data');
                    
                    // Set weather theme and animations
                    this.setWeatherTheme(weatherData.current.weather_code);
                    
                    // Update UI with enhanced data
                    this.updateUIWithEnhancedData(weatherData, cityName, elevation);
                    
                    // Update last updated time
                    const now = new Date();
                    document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleTimeString()}`;
                    
                    this.showSuccess(`${cityName} weather updated successfully!`);
                    
                } catch (error) {
                    console.error('Weather data error:', error);
                    this.showError('Weather service temporarily unavailable. Please try again.');
                    throw error;
                } finally {
                    this.showLoading(false);
                }
            }
            
            setWeatherTheme(weatherCode) {
                // Clear previous effects
                this.clearWeatherEffects();
                
                // Remove all weather theme classes
                document.body.classList.remove('sunny-bg', 'cloudy-bg', 'rainy-bg', 'stormy-bg', 'foggy-bg', 'snowy-bg');
                
                const sunGlow = document.querySelector('.sun-glow');
                const sunRays = document.querySelector('.sun-rays');
                
                // Set theme based on weather code
                if (weatherCode === 0) {
                    // Clear sky
                    document.body.classList.add('sunny-bg');
                    sunGlow.style.opacity = '0.7';
                    sunRays.style.opacity = '0.4';
                } else if (weatherCode <= 3) {
                    // Partly cloudy to overcast
                    document.body.classList.add('cloudy-bg');
                    this.createClouds(weatherCode === 3 ? 8 : 4);
                } else if (weatherCode >= 45 && weatherCode <= 48) {
                    // Fog
                    document.body.classList.add('foggy-bg');
                    this.createFog();
                } else if (weatherCode >= 61 && weatherCode <= 82) {
                    // Rain
                    document.body.classList.add('rainy-bg');
                    this.createRain(weatherCode >= 80 && weatherCode <= 82);
                } else if (weatherCode >= 71 && weatherCode <= 86) {
                    // Snow
                    document.body.classList.add('snowy-bg');
                    this.createSnow();
                } else if (weatherCode >= 95) {
                    // Thunderstorm
                    document.body.classList.add('stormy-bg');
                    this.createRain(true);
                    this.createLightning();
                }
            }
            
            clearWeatherEffects() {
                // Clear all dynamically created effects
                this.currentEffects.forEach(effect => {
                    if (effect.parentNode) {
                        effect.parentNode.removeChild(effect);
                    }
                });
                this.currentEffects = [];
                
                // Reset sun
                document.querySelector('.sun-glow').style.opacity = '0';
                document.querySelector('.sun-rays').style.opacity = '0';
            }
            
            createClouds(count = 4) {
                const container = document.querySelector('.background-effects');
                
                for (let i = 0; i < count; i++) {
                    const cloud = document.createElement('div');
                    cloud.className = 'cloud';
                    cloud.style.cssText = `
                        width: ${150 + Math.random() * 200}px;
                        height: ${50 + Math.random() * 100}px;
                        top: ${20 + Math.random() * 60}%;
                        left: ${-200 + Math.random() * 100}%;
                        animation: cloudFloat ${20 + Math.random() * 20}s linear infinite;
                        animation-delay: ${Math.random() * 10}s;
                        opacity: ${0.3 + Math.random() * 0.5};
                    `;
                    container.appendChild(cloud);
                    this.currentEffects.push(cloud);
                }
            }
            
            createRain(isHeavy = false) {
                const container = document.querySelector('.background-effects');
                const dropCount = isHeavy ? 150 : 80;
                
                for (let i = 0; i < dropCount; i++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.cssText = `
                        height: ${15 + Math.random() * 20}px;
                        left: ${Math.random() * 100}%;
                        top: -20px;
                        animation: rainFall ${0.5 + Math.random()}s linear infinite;
                        animation-delay: ${Math.random() * 2}s;
                        opacity: ${0.3 + Math.random() * 0.5};
                    `;
                    container.appendChild(drop);
                    this.currentEffects.push(drop);
                }
            }
            
            createSnow() {
                const container = document.querySelector('.background-effects');
                
                for (let i = 0; i < 60; i++) {
                    const flake = document.createElement('div');
                    flake.className = 'rain-drop';
                    flake.style.cssText = `
                        width: 3px;
                        height: 3px;
                        background: rgba(255, 255, 255, 0.8);
                        border-radius: 50%;
                        left: ${Math.random() * 100}%;
                        top: -10px;
                        animation: snowFall ${3 + Math.random() * 5}s linear infinite;
                        animation-delay: ${Math.random() * 2}s;
                        opacity: ${0.5 + Math.random() * 0.5};
                    `;
                    container.appendChild(flake);
                    this.currentEffects.push(flake);
                }
            }
            
            createFog() {
                const container = document.querySelector('.background-effects');
                
                for (let i = 0; i < 3; i++) {
                    const fog = document.createElement('div');
                    fog.className = 'cloud';
                    fog.style.cssText = `
                        width: ${200 + Math.random() * 300}px;
                        height: ${100 + Math.random() * 150}px;
                        top: ${30 + Math.random() * 40}%;
                        left: ${-100 + Math.random() * 200}%;
                        animation: cloudFloat ${40 + Math.random() * 30}s linear infinite;
                        animation-delay: ${Math.random() * 5}s;
                        opacity: ${0.1 + Math.random() * 0.2};
                        filter: blur(40px);
                    `;
                    container.appendChild(fog);
                    this.currentEffects.push(fog);
                }
            }
            
            createLightning() {
                const container = document.querySelector('.background-effects');
                
                setInterval(() => {
                    if (Math.random() > 0.7) {
                        const flash = document.createElement('div');
                        flash.style.cssText = `
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(255, 255, 255, 0.3);
                            z-index: 1;
                            animation: none;
                            opacity: 0;
                        `;
                        container.appendChild(flash);
                        
                        // Flash effect
                        let opacity = 0.3;
                        const interval = setInterval(() => {
                            opacity -= 0.1;
                            flash.style.opacity = opacity;
                            if (opacity <= 0) {
                                clearInterval(interval);
                                flash.remove();
                            }
                        }, 50);
                        
                        this.currentEffects.push(flash);
                    }
                }, 2000);
            }
            
            updateUIWithEnhancedData(weatherData, cityName, elevation) {
                const current = weatherData.current;
                const hourly = weatherData.hourly;
                const daily = weatherData.daily;
                
                // Weather icon and description
                const weatherCode = current.weather_code;
                const icon = this.weatherIcons[weatherCode] || "‚ùì";
                const description = this.weatherDescriptions[weatherCode] || "Unknown";
                
                document.getElementById('weatherIcon').textContent = icon;
                document.getElementById('weatherDesc').textContent = description;
                document.getElementById('tempDisplay').textContent = `${Math.round(current.temperature_2m)}¬∞C`;
                document.getElementById('feelsLike').textContent = `Feels like ${Math.round(current.apparent_temperature)}¬∞C`;
                
                // Elevation
                const altitudeMeters = elevation || weatherData.elevation || 0;
                document.getElementById('altitudeValue').textContent = `${Math.round(altitudeMeters)}m`;
                
                // Sun times and day length
                if (daily.sunrise && daily.sunrise[0]) {
                    const sunriseTime = new Date(daily.sunrise[0]);
                    const sunsetTime = new Date(daily.sunset[0]);
                    const dayLengthMs = sunsetTime - sunriseTime;
                    const dayLengthHours = Math.floor(dayLengthMs / (1000 * 60 * 60));
                    const dayLengthMinutes = Math.floor((dayLengthMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('sunriseTime').textContent = 
                        sunriseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('sunsetTime').textContent = 
                        sunsetTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    document.getElementById('dayLength').textContent = 
                        `${dayLengthHours}h ${dayLengthMinutes}m`;
                }
                
                // Moon phase
                const moonPhase = this.calculateMoonPhase();
                document.getElementById('moonFill').style.width = `${moonPhase.fill * 100}%`;
                document.getElementById('moonPhase').textContent = `${moonPhase.emoji} ${moonPhase.name}`;
                document.getElementById('moonIllumination').textContent = `${Math.round(moonPhase.fill * 100)}% illuminated`;
                
                // AQI - Calculate based on weather conditions
                const aqi = this.calculateAQI(weatherCode, current.relative_humidity_2m, current.wind_speed_10m);
                const aqiInfo = this.getAQIInfo(aqi);
                
                // Fix AQI Ring
                const aqiFill = document.getElementById('aqiCircleFill');
                const aqiPercentage = (aqi / 300) * 100;
                aqiFill.style.setProperty('--aqi-percent', aqiPercentage / 100);
                aqiFill.style.background = `conic-gradient(${aqiInfo.color} 0deg, ${aqiInfo.color} ${(aqi/300)*360}deg, #111 ${(aqi/300)*360}deg, #111 360deg)`;
                
                document.getElementById('aqiValue').textContent = aqi;
                document.getElementById('aqiValue').style.color = aqiInfo.color;
                document.getElementById('aqiLabel').textContent = aqiInfo.label;
                document.getElementById('aqiLabel').style.color = aqiInfo.color;
                
                // Humidity
                const humidity = current.relative_humidity_2m || 50;
                document.getElementById('humidityValue').textContent = `${Math.round(humidity)}%`;
                document.getElementById('humidityFill').style.width = `${humidity}%`;
                
                // UV Index
                const uvIndex = this.calculateUVIndex(weatherCode);
                document.getElementById('uvValue').textContent = uvIndex.toFixed(1);
                const uvInfo = this.getUVInfo(uvIndex);
                document.getElementById('uvRisk').textContent = uvInfo.risk;
                document.getElementById('uvRisk').style.color = uvInfo.color;
                document.getElementById('uvFill').style.width = `${(uvIndex / 12) * 100}%`;
                
                // Precipitation
                const currentHour = new Date().getHours();
                const precipIndex = hourly.time ? hourly.time.findIndex(time => {
                    const hour = new Date(time).getHours();
                    return hour === currentHour;
                }) : 0;
                const precip = precipIndex >= 0 ? (hourly.precipitation_probability[precipIndex] || 0) : 0;
                document.getElementById('precipValue').textContent = `${Math.round(precip)}%`;
                document.getElementById('precipFill').style.width = `${precip}%`;
                
                // Wind
                const windSpeed = current.wind_speed_10m;
                const windGust = current.wind_gusts_10m;
                const windDirection = this.getWindDirection(current.wind_direction_10m);
                
                document.getElementById('windValue').textContent = `${Math.round(windSpeed)} km/h`;
                document.getElementById('windGustValue').textContent = `Gust: ${Math.round(windGust)} km/h`;
                document.getElementById('windDirection').textContent = `Direction: ${windDirection}`;
                
                // Additional Metrics
                document.getElementById('pressureValue').textContent = `${Math.round(current.pressure_msl)} hPa`;
                document.getElementById('visibilityValue').textContent = `${(current.visibility / 1000).toFixed(1)} km`;
                document.getElementById('cloudCoverValue').textContent = `${Math.round(current.cloud_cover)}%`;
                
                // Calculate dew point
                const dewPoint = this.calculateDewPoint(current.temperature_2m, humidity);
                document.getElementById('dewPointValue').textContent = `${Math.round(dewPoint)}¬∞C`;
                
                // Update forecast
                this.updateForecast(daily);
                
                // Create chart
                this.createChart(hourly.temperature_2m);
                
                // Update city display
                document.getElementById('currentCity').textContent = `${cityName} ‚Ä¢ ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            }
            
            calculateAQI(weatherCode, humidity, windSpeed) {
                let base = 30; // Base AQI
                
                // Adjust based on weather
                if (weatherCode === 0 || weatherCode === 1) base += 20; // Clear skies - good air
                if (weatherCode === 3) base += 40; // Overcast - worse air
                if (weatherCode >= 45 && weatherCode <= 48) base += 60; // Fog - poor air
                if (weatherCode >= 61 && weatherCode <= 82) base -= 30; // Rain cleans air
                if (weatherCode >= 95) base += 50; // Storms - poor air
                
                // Adjust based on humidity
                if (humidity > 80) base += 30;
                else if (humidity > 60) base += 20;
                else if (humidity < 30) base += 10;
                
                // Adjust based on wind (wind disperses pollution)
                if (windSpeed > 20) base -= 40;
                else if (windSpeed > 10) base -= 20;
                else if (windSpeed < 5) base += 20;
                
                // Add some randomness for realism
                base += Math.random() * 20 - 10;
                
                return Math.min(300, Math.max(0, Math.round(base)));
            }
            
            getAQIInfo(aqi) {
                if (aqi <= 50) return { label: "GOOD", color: "#0f0" };
                if (aqi <= 100) return { label: "MODERATE", color: "#ff0" };
                if (aqi <= 150) return { label: "UNHEALTHY", color: "#ff8800" };
                if (aqi <= 200) return { label: "BAD", color: "#ff3300" };
                return { label: "HAZARDOUS", color: "#ff0066" };
            }
            
            calculateUVIndex(weatherCode) {
                const hour = new Date().getHours();
                const month = new Date().getMonth();
                
                let baseUV = 1;
                
                // Time of day
                if (hour >= 10 && hour <= 14) baseUV += 5;
                if (hour >= 8 && hour <= 16) baseUV += 3;
                
                // Season (summer has higher UV)
                if (month >= 5 && month <= 7) baseUV += 2;
                
                // Weather conditions
                if (weatherCode === 0) baseUV += 4;
                if (weatherCode === 1 || weatherCode === 2) baseUV += 2;
                if (weatherCode === 3) baseUV += 1;
                if (weatherCode >= 61 && weatherCode <= 82) baseUV -= 2;
                if (weatherCode >= 45 && weatherCode <= 48) baseUV -= 1;
                
                return Math.min(12, Math.max(0, baseUV));
            }
            
            getUVInfo(uvIndex) {
                if (uvIndex >= 8) return { risk: "VERY HIGH", color: "#ff0066" };
                if (uvIndex >= 6) return { risk: "HIGH", color: "#ff5500" };
                if (uvIndex >= 3) return { risk: "MODERATE", color: "#ffcc00" };
                return { risk: "LOW", color: "#0f0" };
            }
            
            calculateDewPoint(temperature, humidity) {
                // Magnus formula for dew point
                const a = 17.27;
                const b = 237.7;
                const alpha = ((a * temperature) / (b + temperature)) + Math.log(humidity / 100);
                return (b * alpha) / (a - alpha);
            }
            
            getWindDirection(degrees) {
                const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
                const index = Math.round((degrees % 360) / 45) % 8;
                return directions[index];
            }
            
            calculateMoonPhase() {
                const now = new Date();
                const phaseIndex = Math.floor((now.getDate() / 30) * 8) % 8;
                const phases = [
                    { name: "New Moon", emoji: "üåë", fill: 0 },
                    { name: "Waxing Crescent", emoji: "üåí", fill: 0.25 },
                    { name: "First Quarter", emoji: "üåì", fill: 0.5 },
                    { name: "Waxing Gibbous", emoji: "üåî", fill: 0.75 },
                    { name: "Full Moon", emoji: "üåï", fill: 1 },
                    { name: "Waning Gibbous", emoji: "üåñ", fill: 0.75 },
                    { name: "Last Quarter", emoji: "üåó", fill: 0.5 },
                    { name: "Waning Crescent", emoji: "üåò", fill: 0.25 }
                ];
                return phases[phaseIndex];
            }
            
            updateForecast(dailyData) {
                const container = document.getElementById('forecastContainer');
                container.innerHTML = '';
                
                const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
                const today = new Date();
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    const dayName = i === 0 ? 'TODAY' : days[date.getDay()];
                    
                    const tempMax = dailyData.temperature_2m_max[i];
                    const tempMin = dailyData.temperature_2m_min[i];
                    const weatherCode = dailyData.weather_code[i];
                    const precip = dailyData.precipitation_probability_max[i] || 0;
                    
                    const card = document.createElement('div');
                    card.className = 'forecast-card';
                    card.innerHTML = `
                        <div class="forecast-day" style="color:#0ff; font-weight:bold;">${dayName}</div>
                        <div class="forecast-icon" style="font-size:24px; margin:8px 0;">${this.weatherIcons[weatherCode] || '‚òÄÔ∏è'}</div>
                        <div class="forecast-temp" style="font-size:20px; font-weight:bold;">${Math.round(tempMax)}¬∞</div>
                        <div style="color:#888; font-size:12px;">${Math.round(tempMin)}¬∞</div>
                        <div style="color:#a0f; font-size:11px; margin-top:5px;">${Math.round(precip)}% precip</div>
                    `;
                    
                    container.appendChild(card);
                }
            }
            
            createChart(temperatures) {
                const canvas = document.getElementById('hourChart');
                const ctx = canvas.getContext('2d');
                
                // Clear previous chart
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set canvas size
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                const width = canvas.width;
                const height = canvas.height;
                const padding = 40;
                const chartWidth = width - padding * 2;
                const chartHeight = height - padding * 2;
                
                // Get next 24 hours
                const tempData = temperatures.slice(0, 24);
                const minTemp = Math.floor(Math.min(...tempData));
                const maxTemp = Math.ceil(Math.max(...tempData));
                const tempRange = maxTemp - minTemp || 1;
                
                // Draw grid
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                // Horizontal grid lines
                const numLines = 6;
                for (let i = 0; i <= numLines; i++) {
                    const y = padding + (i / numLines) * chartHeight;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                    
                    // Draw temperature labels
                    const temp = maxTemp - (i / numLines) * tempRange;
                    ctx.fillStyle = '#0ff';
                    ctx.font = '10px Orbitron';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${Math.round(temp)}¬∞`, padding - 5, y + 3);
                }
                
                // Vertical grid lines and hour labels
                for (let i = 0; i < 24; i += 3) {
                    const x = padding + (i / 23) * chartWidth;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                    
                    // Draw hour labels
                    ctx.fillStyle = '#0ff';
                    ctx.font = '10px Orbitron';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${i}:00`, x, height - padding + 15);
                }
                
                // Draw temperature line
                ctx.beginPath();
                ctx.strokeStyle = '#a0f';
                ctx.lineWidth = 2;
                ctx.fillStyle = 'rgba(160, 0, 255, 0.1)';
                
                for (let i = 0; i < tempData.length; i++) {
                    const x = padding + (i / (tempData.length - 1)) * chartWidth;
                    const y = padding + ((maxTemp - tempData[i]) / tempRange) * chartHeight;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                // Fill area under curve
                ctx.lineTo(width - padding, height - padding);
                ctx.lineTo(padding, height - padding);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
                
                // Draw data points
                ctx.fillStyle = '#a0f';
                for (let i = 0; i < tempData.length; i += 3) {
                    const x = padding + (i / (tempData.length - 1)) * chartWidth;
                    const y = padding + ((maxTemp - tempData[i]) / tempRange) * chartHeight;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Draw temperature value
                    ctx.fillStyle = '#fff';
                    ctx.font = '9px Orbitron';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${Math.round(tempData[i])}¬∞`, x, y - 8);
                    ctx.fillStyle = '#a0f';
                }
            }
            
            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }
            
            showMessage(message, type = 'info') {
                const element = document.getElementById('currentCity');
                element.textContent = message;
                element.style.color = type === 'loading' ? '#0ff' : 
                                   type === 'error' ? '#f00' : 
                                   type === 'success' ? '#0f0' : '#0ff';
            }
            
            showError(message) {
                const element = document.getElementById('errorMessage');
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
            
            showSuccess(message) {
                const element = document.getElementById('successMessage');
                element.textContent = message;
                element.style.display = 'block';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
            
            hideMessages() {
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('successMessage').style.display = 'none';
            }
            
            initializeEmptyState() {
                // Reset all fields
                document.getElementById('weatherIcon').textContent = 'üìç';
                document.getElementById('weatherDesc').textContent = '--';
                document.getElementById('tempDisplay').textContent = '--¬∞C';
                document.getElementById('feelsLike').textContent = 'Feels like --¬∞C';
                document.getElementById('altitudeValue').textContent = '--';
                document.getElementById('sunriseTime').textContent = '--:--';
                document.getElementById('sunsetTime').textContent = '--:--';
                document.getElementById('dayLength').textContent = '-- hrs';
                document.getElementById('moonFill').style.width = '0%';
                document.getElementById('moonPhase').textContent = '--';
                document.getElementById('moonIllumination').textContent = '--% illuminated';
                
                // Reset AQI
                const aqiFill = document.getElementById('aqiCircleFill');
                aqiFill.style.setProperty('--aqi-percent', '0');
                aqiFill.style.background = 'conic-gradient(#0f0 0deg, #111 0deg, #111 360deg)';
                document.getElementById('aqiValue').textContent = '--';
                document.getElementById('aqiLabel').textContent = 'ENTER CITY';
                document.getElementById('aqiLabel').style.color = '#0f0';
                
                // Reset metrics
                document.getElementById('humidityValue').textContent = '--%';
                document.getElementById('humidityFill').style.width = '0%';
                document.getElementById('uvValue').textContent = '--';
                document.getElementById('uvRisk').textContent = '--';
                document.getElementById('uvFill').style.width = '0%';
                document.getElementById('precipValue').textContent = '--%';
                document.getElementById('precipFill').style.width = '0%';
                document.getElementById('windValue').textContent = '-- km/h';
                document.getElementById('windGustValue').textContent = 'Gust: -- km/h';
                document.getElementById('windDirection').textContent = 'Direction: --';
                
                // Reset additional metrics
                document.getElementById('pressureValue').textContent = '-- hPa';
                document.getElementById('visibilityValue').textContent = '-- km';
                document.getElementById('cloudCoverValue').textContent = '--%';
                document.getElementById('dewPointValue').textContent = '--¬∞C';
                
                // Clear forecast and chart
                document.getElementById('forecastContainer').innerHTML = '';
                const canvas = document.getElementById('hourChart');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Clear weather effects
                this.clearWeatherEffects();
                
                // Reset last updated
                document.getElementById('lastUpdated').textContent = '';
                
                this.hideMessages();
            }
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            new WeatherDashboard();
        });
    </script>
</body>
</html>